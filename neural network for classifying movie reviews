import numpy as np
import tensorflow as tf
from tensorflow.keras.datasets import imdb
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense
import matplotlib.pyplot as plt
(train_data,train_labels),(test_data,test_labels)=imdb.load_data(num_words=1000)
import numpy as np
def vectorize_sequences(sequences,dimension=10000):
  results=np.zeros((len(sequences),dimension))
  for i,sequence in enumerate(sequences):
    results[i,sequence]=1
    return results
# Vectorixw Training Dara
X_train =vectorize_sequences(train_data)

# Vectorize Testing Data
X_test=vectorize_sequences(test_data)

X_train[0]

X_train.shape

y_train=np.asarray(train_labels).astype('float32')
y_test=np.asarray(test_labels).astype('float32')

model=Sequential([
    Dense(16,activation='relu',input_shape=(10000,)),
    Dense(16,activation='relu'),
    Dense(1,activation='sigmoid')
])

model.compile(optimizer='adam',
              loss='binary_crossentropy',
              metrics=['accuracy'])

history=model.fit(X_train,y_train,
                  epochs=10,
                  batch_size=512,
                  validation_split=0.2,)
# Evaluate on test data
test_loss, test_accuracy = model.evaluate(X_test, y_test, verbose=2)

print(f"Test Loss: {test_loss:.4f}")
print(f"Test Accuracy: {test_accuracy:.4f}")

# Plot training & validation accuracy
plt.plot(history.history['accuracy'], label='Train Accuracy')
plt.plot(history.history['val_accuracy'], label='Val Accuracy')
plt.axhline(y=test_accuracy, color='green', linestyle='--', label=f'Test Accuracy: {test_accuracy:.4f}')
plt.title('Model Accuracy Over Epochs')
plt.xlabel('Epoch')
plt.ylabel('Accuracy')
plt.legend()
plt.grid(True)
plt.show()

model.save("imdb_sentiment_model.h5")


from tensorflow.keras.models import load_model
# load the model
loaded_model =load_model("imdb_sentiment_model.h5")

word_index=imdb.get_word_index()

def encode_review(text,word_index,max_words=10000):
  tokens=text.lower().split()
  encoded=[word_index.get(word,0) for word in tokens]
  return encoded

from tensorflow.keras.preprocessing.sequence import pad_sequences

def preprocess_text(text):
  encoded=encode_review(text,word_index)
  vectorized=np.zeros((1,10000))
  for index in encoded:
    if index<10000:
      vectorized[0,index]=1
    return vectorized

# Example 1 prediction
sample_text="This movie was fantastic and full of emotional depth"
x_input=preprocess_text(sample_text)
prediction=loaded_model.predict(x_input)

# Interpret Prediction
label="Positive" if prediction>=0.5 else "Negative"
print(f"Sentiment :{label} (Confidence :{prediction[0][0]:.4f})")
 

# Example 2 prediction
sample_text="Top-notch music and an emotional climax that leaves you in awe!"
x_input=preprocess_text(sample_text)
prediction=loaded_model.predict(x_input)

# Interpret Prediction
label="Positive" if prediction>=0.5 else "Negative"
print(f"Sentiment :{label} (Confidence :{prediction[0][0]:.4f})")

# Example 3 prediction
sample_text="I Kept checking my watch waiting for it to end!"
x_input=preprocess_text(sample_text)
prediction=loaded_model.predict(x_input)

# Interpret Prediction
label="Positive" if prediction>=0.5 else "Negative"
print(f"Sentiment :{label} (Confidence :{prediction[0][0]:.4f})")


# Example 4 prediction
sample_text="Some parts were really engaging,but others were painfully slow."
x_input=preprocess_text(sample_text)
prediction=loaded_model.predict(x_input)

# Interpret Prediction
label="Positive" if prediction>=0.5 else "Negative"
print(f"Sentiment :{label} (Confidence :{prediction[0][0]:.4f})")

